image: node:10
stages:
  - build
  - deploy
Build Job:
  stage: build
  cache:
    key: "$CI_COMMIT_REF_NAME"
    paths:
      - "$HOME/.npm"
      - .cache/
  before_script:
    - npm ci
  script:
    - npm run build
  artifacts:
    name: build
    paths:
      - build
Deploy Job:
  stage: deploy
  script:
    - echo Deploying app
  environment:
    name: staging
    url: https://staging.example.com
  only:
    refs:
      - master
    changes:
      - src/**/*
      - static/**/*
      - content/**/*
      - package.json
      - package-lock.json
      - .gitlab-ci.yml
